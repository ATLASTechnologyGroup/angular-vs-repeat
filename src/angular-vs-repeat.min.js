//
// Copyright Kamil PÄ™kala http://github.com/kamilkp
// Angular Virtual Scroll Repeat v1.0.0-rc12 2015/08/03
//
!function(a,b){"use strict";function c(){if("pageYOffset"in a)return{scrollTop:pageYOffset,scrollLeft:pageXOffset};var b,c,d=document,e=d.documentElement,f=d.body;return b=e.scrollLeft||f.scrollLeft||0,c=e.scrollTop||f.scrollTop||0,{scrollTop:c,scrollLeft:b}}function d(b,c){return b===a?"clientWidth"===c?a.innerWidth:a.innerHeight:b[c]}function e(b,d){return b===a?c()[d]:b[d]}function f(b,d,e){var f=b.getBoundingClientRect()[e?"left":"top"],g=d===a?0:d.getBoundingClientRect()[e?"left":"top"],h=f-g+(d===a?c():d)[e?"scrollLeft":"scrollTop"];return h}var g=document.documentElement,h=g.matches?"matches":g.matchesSelector?"matchesSelector":g.webkitMatches?"webkitMatches":g.webkitMatchesSelector?"webkitMatchesSelector":g.msMatches?"msMatches":g.msMatchesSelector?"msMatchesSelector":g.mozMatches?"mozMatches":g.mozMatchesSelector?"mozMatchesSelector":null,i=b.element.prototype.closest||function(a){for(var c=this[0].parentNode;c!==document.documentElement&&null!=c&&!c[h](a);)c=c.parentNode;return c&&c[h](a)?b.element(c):b.element()},j=b.module("vs-repeat",[]).directive("vsRepeat",["$compile","$parse",function(c,g){return{restrict:"A",scope:!0,compile:function(h){var j=h.children().eq(0),k=j.attr("ng-repeat")||j.attr("data-ng-repeat"),l=j[0].outerHTML,m=/^\s*(\S+)\s+in\s+([\S\s]+?)(track\s+by\s+\S+)?$/.exec(k),n=m[1],o=m[2],p=m[3],q="$vs_collection",r={vsRepeat:"elementSize",vsOffsetBefore:"offsetBefore",vsOffsetAfter:"offsetAfter",vsExcess:"excess"};return h.empty(),a.getComputedStyle&&"absolute"===a.getComputedStyle(h[0]).position||h.css("position","relative"),{pre:function(h,j,k){function m(a,c){if(!C||C.length<1)return h[q]=[],z=0,v(0),void(h.sizesCumulative=[0]);if(z=C.length,F){h.sizes=C.map(function(a){var c=h.$new(!1);b.extend(c,a),c[n]=a;var d=k.vsSize||k.vsSizeProperty?c.$eval(k.vsSize||k.vsSizeProperty):h.elementSize;return c.$destroy(),d});var d=0;h.sizesCumulative=h.sizes.map(function(a){var b=d;return d+=a,b}),h.sizesCumulative.push(d)}else s();u(c)}function s(){E&&h.$$postDigest(function(){if(A[0].offsetHeight||A[0].offsetWidth)for(var a=A.children(),b=0;b<a.length;){if(null!=a[b].attributes["ng-repeat"]||null!=a[b].attributes["data-ng-repeat"]){a[b][K]&&(h.elementSize=a[b][K],u(),E=!1,h.$root&&!h.$root.$$phase&&h.$apply());break}b++}else var c=h.$watch(function(){(j[0].offsetHeight||j[0].offsetWidth)&&(c(),s())})})}function t(){"undefined"!=typeof k.vsAutoresize&&(E=!0,s(),h.$root&&!h.$root.$$phase&&h.$apply()),y()&&(h.$apply(),h.$broadcast("vsSetOffset-refresh"))}function u(a){M=void 0,N=void 0,O=z,P=0,y(a),v(F?h.sizesCumulative[z]:h.elementSize*z),h.$evalAsync(function(){h.$broadcast("vsSetOffset-refresh")}),h.$emit("vsRepeatReinitialized",h.startIndex,h.endIndex)}function v(a){h.totalSize=h.offsetBefore+a+h.offsetAfter}function w(){var a=d(G[0],J);a!==Q&&(u(),h.$root&&!h.$root.$$phase&&(h.$apply(),h.$broadcast("vsSetOffset-refresh"))),Q=a}function x(a){var b=!1;return void 0!==a&&"number"==typeof a&&(b=Math.max(a,0),G[0][L]!==b?(G[0][L]=b,H=!0):b=!1,h.$emit("vsRepeatScrolled",b)),b}function y(a){var b,c,i,k,l=e(G[0],L),m=d(G[0],J),n=j[0]===G[0]?0:f(j[0],G[0],D),o=!0,p=h.startIndex,r=h.endIndex;if(a&&void 0!==a.elementSize&&(h.elementSize=a.elementSize),a&&void 0!==a.scrollIndex){if("undefined"!=typeof h.scrollSettings&&(h.scrollSettings.scrollIndex=a.scrollIndex),F?(k=h.sizes[a.scrollIndex],i=h.sizesCumulative[a.scrollIndex]):(k=h.elementSize,i=a.scrollIndex*h.elementSize),void 0!==a.scrollIndexPosition)switch("undefined"!=typeof h.scrollSettings&&(h.scrollSettings.scrollIndexPosition=a.scrollIndexPosition),b=0,typeof a.scrollIndexPosition){case"number":b=a.scrollIndexPosition+h.offsetBefore;break;case"string":switch(a.scrollIndexPosition){case"top":b=h.offsetBefore;break;case"middle":b=(m-k)/2;break;case"bottom":b=m-k-h.offsetAfter;break;case"inview":case"inview#top":case"inview#middle":case"inview#bottom":case"inview#auto":G[0][L]<=i&&G[0][L]+m-k>=i?(o=!1,b=i-G[0][L]):(("inview#top"===a.scrollIndexPosition||"inview"===a.scrollIndexPosition)&&(b=h.offsetBefore),"inview#bottom"===a.scrollIndexPosition&&(b=m-k+h.offsetAfter),"inview#middle"===a.scrollIndexPosition&&(b=(m-k)/2),"inview#auto"===a.scrollIndexPosition&&(b=G[0][L]<=i?m-k+h.offsetAfter:h.offsetBefore));break;default:console.warn("Incorrect scrollIndexPosition string value")}break;default:console.warn("Incorrect scrollIndexPosition type")}else o=!1,b=F?h.sizesCumulative[a.scrollIndex]-G[0][L]:a.scrollIndex*h.elementSize-G[0][L];if(p=a.scrollIndex,F){for(;h.sizesCumulative[p]>h.sizesCumulative[a.scrollIndex]-b;)p--;for(c=Math.max(p,0),p=Math.max(Math.floor(p-h.excess/2),0),r=p;h.sizesCumulative[r]<h.sizesCumulative[c]-h.offsetBefore+m;)r++;r=Math.min(Math.ceil(r+h.excess/2),z)}else{for(;p*h.elementSize>a.scrollIndex*h.elementSize-b;)p--;c=Math.max(p,0),p=Math.max(Math.floor(p-h.excess/2),0),r=Math.min(p+Math.ceil(m/h.elementSize)+h.excess/2,z)}}else if(F){for(p=0;h.sizesCumulative[p]<l-h.offsetBefore-n;)p++;for(p>0&&p--,p=Math.max(Math.floor(p-h.excess/2),0),r=p;h.sizesCumulative[r]<l-h.offsetBefore-n+m;)r++;r=Math.min(Math.ceil(r+h.excess/2),z)}else p=Math.max(Math.floor((l-h.offsetBefore-n)/h.elementSize)-h.excess/2,0),r=Math.min(p+Math.ceil(m/h.elementSize)+h.excess,z);O=Math.min(p,O),P=Math.max(r,P),h.startIndex=I.latch?O:p,h.endIndex=I.latch?P:r,void 0!==a&&void 0!==a.scrollIndex&&void 0!==b&&o&&x(i-b);var s=!1;return null==M?s=!0:null==N&&(s=!0),s||(I.hunked?Math.abs(h.startIndex-M)>=h.excess/2||0===h.startIndex&&0!==M?s=!0:(Math.abs(h.endIndex-N)>=h.excess/2||h.endIndex===z&&N!==z)&&(s=!0):s=h.startIndex!==M||h.endIndex!==N),s&&(h[q]=C.slice(h.startIndex,h.endIndex),h.$emit("vsRepeatInnerCollectionUpdated",h.startIndex,h.endIndex,M,N),M=h.startIndex,N=h.endIndex,h.$$postDigest(function(){var a=F?"(sizesCumulative[$index + startIndex] + offsetBefore)":"(($index + startIndex) * elementSize + offsetBefore)",b=g(a),c=b(h,{$index:0}),d=b(h,{$index:h[q].length}),e=h.totalSize;A.css(D?{"padding-left":c+"px","padding-right":e-d+"px"}:{"padding-top":c+"px","padding-bottom":e-d+"px"})})),s}var z,A,B=b.element(l),C=[],D="undefined"!=typeof k.vsHorizontal,E=!k.vsRepeat,F=!!k.vsSize||!!k.vsSizeProperty,G=k.vsScrollParent?"window"===k.vsScrollParent?b.element(a):i.call(j,k.vsScrollParent):j,H=!1,I="vsOptions"in k?h.$eval(k.vsOptions):{},J=D?"clientWidth":"clientHeight",K=D?"offsetWidth":"offsetHeight",L=D?"scrollLeft":"scrollTop";if(h.totalSize=0,!("vsSize"in k)&&"vsSizeProperty"in k&&console.warn("vs-size-property attribute is deprecated. Please use vs-size attrubute which also accepts angular expressions."),0===G.length)throw"Specified scroll parent selector did not match any element";h.$scrollParent=G,F&&(h.sizesCumulative=[]),h.elementSize=+k.vsRepeat||d(G[0],J)||50,h.offsetBefore=0,h.offsetAfter=0,h.excess=2,h.scrollSettings={scrollIndex:0,scrollIndexPosition:"top"},h.$watch(k.vsScrollSettings,function(a){"undefined"!=typeof a&&(h.scrollSettings=a,u(h.scrollSettings))},!0),Object.keys(r).forEach(function(a){k[a]&&k.$observe(a,function(b){h[r[a]]=+b,u()})}),h.$watchCollection(o,function(a){C=a||[],m()}),B.attr("ng-repeat",n+" in "+q+(p?" "+p:"")).addClass("vs-repeat-repeated-element"),A=b.element('<div class="vs-repeat-padding-element"></div>'),j.append(A),c(B)(h),A.append(B),h.startIndex=0,h.endIndex=0,G.on("scroll",function(){H?H=!1:y()&&(h.$apply(),h.$broadcast("vsSetOffset-refresh"))}),b.element(a).on("resize",t),h.$on("$destroy",function(){b.element(a).off("resize",t)}),h.$on("vsRepeatTrigger",m),h.$on("vsRepeatResize",function(){E=!0,s()});var M,N,O,P;h.$on("vsRenderAll",function(){I.latch&&setTimeout(function(){var a=z;P=Math.max(a,P),h.endIndex=I.latch?P:a,h[q]=C.slice(h.startIndex,h.endIndex),N=h.endIndex,h.$apply(function(){h.$emit("vsRenderAllDone")})})});var Q;h.$watch(function(){"function"==typeof a.requestAnimationFrame?a.requestAnimationFrame(w):w()})}}}}}]);"undefined"!=typeof module&&module.exports&&(module.exports=j.name)}(window,window.angular);