//
// Copyright Kamil PÄ™kala http://github.com/kamilkp
// Angular Virtual Scroll Repeat v1.0.0-rc12 2015/08/03
//
!function(a,b){"use strict";function c(){if("pageYOffset"in a)return{scrollTop:pageYOffset,scrollLeft:pageXOffset};var b,c,d=document,e=d.documentElement,f=d.body;return b=e.scrollLeft||f.scrollLeft||0,c=e.scrollTop||f.scrollTop||0,{scrollTop:c,scrollLeft:b}}function d(b,c){return b===a?"clientWidth"===c?a.innerWidth:a.innerHeight:b[c]}function e(b,d){return b===a?c()[d]:b[d]}function f(b,d,e){var f=b.getBoundingClientRect()[e?"left":"top"],g=d===a?0:d.getBoundingClientRect()[e?"left":"top"],h=f-g+(d===a?c():d)[e?"scrollLeft":"scrollTop"];return h}var g=document.documentElement,h=g.matches?"matches":g.matchesSelector?"matchesSelector":g.webkitMatches?"webkitMatches":g.webkitMatchesSelector?"webkitMatchesSelector":g.msMatches?"msMatches":g.msMatchesSelector?"msMatchesSelector":g.mozMatches?"mozMatches":g.mozMatchesSelector?"mozMatchesSelector":null,i=b.element.prototype.closest||function(a){for(var c=this[0].parentNode;c!==document.documentElement&&null!=c&&!c[h](a);)c=c.parentNode;return c&&c[h](a)?b.element(c):b.element()},j=b.module("vs-repeat",[]).directive("vsRepeat",["$compile","$parse",function(c,g){return{restrict:"A",scope:!0,compile:function(h){var j,k,l,m,n,o,p=h.children().eq(0),q=p[0].outerHTML,r="$vs_collection",s=!1,t={vsRepeat:"elementSize",vsOffsetBefore:"offsetBefore",vsOffsetAfter:"offsetAfter",vsExcess:"excess"};if(p.attr("ng-repeat"))o="ng-repeat",j=p.attr("ng-repeat");else if(p.attr("data-ng-repeat"))o="data-ng-repeat",j=p.attr("data-ng-repeat");else if(p.attr("ng-repeat-start"))s=!0,o="ng-repeat-start",j=p.attr("ng-repeat-start");else{if(!p.attr("data-ng-repeat-start"))throw new Error("angular-vs-repeat: no ng-repeat directive on a child element");s=!0,o="data-ng-repeat-start",j=p.attr("data-ng-repeat-start")}if(k=/^\s*(\S+)\s+in\s+([\S\s]+?)(track\s+by\s+\S+)?$/.exec(j),l=k[1],m=k[2],n=k[3],s)for(var u=0,v=h.children().eq(0);null==v.attr("ng-repeat-end")&&null==v.attr("data-ng-repeat-end");)u++,v=h.children().eq(u),q+=v[0].outerHTML;return h.empty(),{pre:function(h,j,k){function p(a,c){if(!E||E.length<1)return h[r]=[],B=0,x(0),void(h.sizesCumulative=[0]);if(B=E.length,J){h.sizes=E.map(function(a){var c=h.$new(!1);b.extend(c,a),c[l]=a;var d=k.vsSize||k.vsSizeProperty?c.$eval(k.vsSize||k.vsSizeProperty):h.elementSize;return c.$destroy(),d});var d=0;h.sizesCumulative=h.sizes.map(function(a){var b=d;return d+=a,b}),h.sizesCumulative.push(d)}else u();w(c)}function u(){I&&h.$$postDigest(function(){if(j[0].offsetHeight||j[0].offsetWidth){for(var a=j.children(),b=0,c=!1,d=!1;b<a.length;){if(null!=a[b].attributes[o]||d){if(c||(h.elementSize=0),c=!0,a[b][O]&&(h.elementSize+=a[b][O]),!s)break;if(null!=a[b].attributes["ng-repeat-end"]||null!=a[b].attributes["data-ng-repeat-end"])break;d=!0}b++}c&&(w(),I=!1,h.$root&&!h.$root.$$phase&&h.$apply())}else var e=h.$watch(function(){(j[0].offsetHeight||j[0].offsetWidth)&&(e(),u())})})}function v(){"undefined"!=typeof k.vsAutoresize&&(I=!0,u(),h.$root&&!h.$root.$$phase&&h.$apply()),A()&&h.$apply()}function w(a){Q=void 0,R=void 0,S=B,T=0,A(a),x(J?h.sizesCumulative[B]:h.elementSize*B),h.$emit("vsRepeatReinitialized",h.startIndex,h.endIndex)}function x(a){h.totalSize=h.offsetBefore+a+h.offsetAfter}function y(){var a=d(K[0],N);a!==U&&(w(),h.$root&&!h.$root.$$phase&&h.$apply()),U=a}function z(a){var b=!1;return void 0!==a&&"number"==typeof a&&(b=Math.max(a,0),K[0][P]!==b?(K[0][P]=b,L=!0):b=!1,h.$emit("vsRepeatScrolled",b)),b}function A(a){var b,c,i,k,l=e(K[0],P),m=d(K[0],N),n=j[0]===K[0]?0:f(j[0],K[0],F),o=!0,p=h.startIndex,q=h.endIndex;if(a&&void 0!==a.elementSize&&(h.elementSize=a.elementSize),a&&void 0!==a.scrollIndex){if("undefined"!=typeof h.scrollSettings&&(h.scrollSettings.scrollIndex=a.scrollIndex),J?(k=h.sizes[a.scrollIndex],i=h.sizesCumulative[a.scrollIndex]):(k=h.elementSize,i=a.scrollIndex*h.elementSize),void 0!==a.scrollIndexPosition)switch("undefined"!=typeof h.scrollSettings&&(h.scrollSettings.scrollIndexPosition=a.scrollIndexPosition),b=0,typeof a.scrollIndexPosition){case"number":b=a.scrollIndexPosition+h.offsetBefore;break;case"string":switch(a.scrollIndexPosition){case"top":b=h.offsetBefore;break;case"middle":b=(m-k)/2;break;case"bottom":b=m-k-h.offsetAfter;break;case"inview":case"inview#top":case"inview#middle":case"inview#bottom":case"inview#auto":K[0][P]<=i&&K[0][P]+m-k>=i?(o=!1,b=i-K[0][P]):(("inview#top"===a.scrollIndexPosition||"inview"===a.scrollIndexPosition)&&(b=h.offsetBefore),"inview#bottom"===a.scrollIndexPosition&&(b=m-k+h.offsetAfter),"inview#middle"===a.scrollIndexPosition&&(b=(m-k)/2),"inview#auto"===a.scrollIndexPosition&&(b=K[0][P]<=i?m-k+h.offsetAfter:h.offsetBefore));break;default:console.warn("Incorrect scrollIndexPosition string value")}break;default:console.warn("Incorrect scrollIndexPosition type")}else o=!1,b=J?h.sizesCumulative[a.scrollIndex]-K[0][P]:a.scrollIndex*h.elementSize-K[0][P];if(p=a.scrollIndex,J){for(;h.sizesCumulative[p]>h.sizesCumulative[a.scrollIndex]-b;)p--;for(c=Math.max(p,0),p=Math.max(Math.floor(p-h.excess/2),0),q=p;h.sizesCumulative[q]<h.sizesCumulative[c]-h.offsetBefore+m;)q++;q=Math.min(Math.ceil(q+h.excess/2),B)}else{for(;p*h.elementSize>a.scrollIndex*h.elementSize-b;)p--;c=Math.max(p,0),p=Math.max(Math.floor(p-h.excess/2),0),q=Math.min(p+Math.ceil(m/h.elementSize)+h.excess/2,B)}}else if(J){for(p=0;h.sizesCumulative[p]<l-h.offsetBefore-n;)p++;for(p>0&&p--,p=Math.max(Math.floor(p-h.excess/2),0),q=p;h.sizesCumulative[q]<l-h.offsetBefore-n+m;)q++;q=Math.min(Math.ceil(q+h.excess/2),B)}else p=Math.max(Math.floor((l-h.offsetBefore-n)/h.elementSize)-h.excess/2,0),q=Math.min(p+Math.ceil(m/h.elementSize)+h.excess,B);S=Math.min(p,S),T=Math.max(q,T),h.startIndex=M.latch?S:p,h.endIndex=M.latch?T:q,void 0!==a&&void 0!==a.scrollIndex&&void 0!==b&&o&&z(i-b);var s=!1;return null==Q?s=!0:null==R&&(s=!0),s||(M.hunked?Math.abs(h.startIndex-Q)>=h.excess/2||0===h.startIndex&&0!==Q?s=!0:(Math.abs(h.endIndex-R)>=h.excess/2||h.endIndex===B&&R!==B)&&(s=!0):s=h.startIndex!==Q||h.endIndex!==R),s&&(h[r]=E.slice(h.startIndex,h.endIndex),h.$emit("vsRepeatInnerCollectionUpdated",h.startIndex,h.endIndex,Q,R),Q=h.startIndex,R=h.endIndex,h.$$postDigest(function(){var a=J?"(sizesCumulative[$index + startIndex] + offsetBefore)":"(($index + startIndex) * elementSize + offsetBefore)",b=g(a),c=b(h,{$index:0}),d=b(h,{$index:h[r].length}),e=h.totalSize,f=F?"width":"height";G.css(f,c+"px"),H.css(f,e-d+"px")})),s}var B,C=b.element(q),D=C[0].tagName.toLowerCase(),E=[],F="undefined"!=typeof k.vsHorizontal,G=b.element("<"+D+' class="vs-repeat-before-content"></'+D+">"),H=b.element("<"+D+' class="vs-repeat-after-content"></'+D+">"),I=!k.vsRepeat,J=!!k.vsSize||!!k.vsSizeProperty,K=k.vsScrollParent?"window"===k.vsScrollParent?b.element(a):i.call(j,k.vsScrollParent):j,L=!1,M="vsOptions"in k?h.$eval(k.vsOptions):{},N=F?"clientWidth":"clientHeight",O=F?"offsetWidth":"offsetHeight",P=F?"scrollLeft":"scrollTop";if(h.totalSize=0,!("vsSize"in k)&&"vsSizeProperty"in k&&console.warn("vs-size-property attribute is deprecated. Please use vs-size attribute which also accepts angular expressions."),0===K.length)throw"Specified scroll parent selector did not match any element";h.$scrollParent=K,J&&(h.sizesCumulative=[]),h.elementSize=+k.vsRepeat||d(K[0],N)||50,h.offsetBefore=0,h.offsetAfter=0,h.excess=2,h.scrollSettings={scrollIndex:0,scrollIndexPosition:"top"},F?(G.css("height","100%"),H.css("height","100%")):(G.css("width","100%"),H.css("width","100%")),h.$watch(k.vsScrollSettings,function(a){"undefined"!=typeof a&&(h.scrollSettings=a,w(h.scrollSettings))},!0),Object.keys(t).forEach(function(a){k[a]&&k.$observe(a,function(b){h[t[a]]=+b,w()})}),h.$watchCollection(m,function(a){E=a||[],p()}),C.eq(0).attr(o,l+" in "+r+(n?" "+n:"")),C.addClass("vs-repeat-repeated-element"),j.append(G),j.append(C),c(C)(h),j.append(H),h.startIndex=0,h.endIndex=0,K.on("scroll",function(){L?L=!1:A()&&h.$apply()}),b.element(a).on("resize",v),h.$on("$destroy",function(){b.element(a).off("resize",v)}),h.$on("vsRepeatTrigger",p),h.$on("vsRepeatResize",function(){I=!0,u()});var Q,R,S,T;h.$on("vsRenderAll",function(){M.latch&&setTimeout(function(){var a=B;T=Math.max(a,T),h.endIndex=M.latch?T:a,h[r]=E.slice(h.startIndex,h.endIndex),R=h.endIndex,h.$$postDigest(function(){var a=F?"width":"height";G.css(a,0),H.css(a,0)}),h.$apply(function(){h.$emit("vsRenderAllDone")})})});var U;h.$watch(function(){"function"==typeof a.requestAnimationFrame?a.requestAnimationFrame(y):y()})}}}}}]);"undefined"!=typeof module&&module.exports&&(module.exports=j.name)}(window,window.angular);