//
// Copyright Kamil PÄ™kala http://github.com/kamilkp
// Angular Virtual Scroll Repeat v1.0.0-rc12 2015/08/03
//
!function(a,b){"use strict";function c(){if("pageYOffset"in a)return{scrollTop:pageYOffset,scrollLeft:pageXOffset};var b,c,d=document,e=d.documentElement,f=d.body;return b=e.scrollLeft||f.scrollLeft||0,c=e.scrollTop||f.scrollTop||0,{scrollTop:c,scrollLeft:b}}function d(b,c){return b===a?"clientWidth"===c?a.innerWidth:a.innerHeight:b[c]}function e(b,d){return b===a?c()[d]:b[d]}function f(b,d,e){var f=b.getBoundingClientRect()[e?"left":"top"],g=d===a?0:d.getBoundingClientRect()[e?"left":"top"],h=f-g+(d===a?c():d)[e?"scrollLeft":"scrollTop"];return h}var g=document.documentElement,h=g.matches?"matches":g.matchesSelector?"matchesSelector":g.webkitMatches?"webkitMatches":g.webkitMatchesSelector?"webkitMatchesSelector":g.msMatches?"msMatches":g.msMatchesSelector?"msMatchesSelector":g.mozMatches?"mozMatches":g.mozMatchesSelector?"mozMatchesSelector":null,i=b.element.prototype.closest||function(a){for(var c=this[0].parentNode;c!==document.documentElement&&null!=c&&!c[h](a);)c=c.parentNode;return c&&c[h](a)?b.element(c):b.element()},j=b.module("vs-repeat",[]).directive("vsRepeat",["$compile","$parse",function(c,g){return{restrict:"A",scope:!0,compile:function(h){var j=h.children().eq(0),k=j.attr("ng-repeat")||j.attr("data-ng-repeat"),l=j[0].outerHTML,m=/^\s*(\S+)\s+in\s+([\S\s]+?)(track\s+by\s+\S+)?$/.exec(k),n=m[1],o=m[2],p=m[3],q="$vs_collection",r={vsRepeat:"elementSize",vsOffsetBefore:"offsetBefore",vsOffsetAfter:"offsetAfter",vsExcess:"excess"};return h.empty(),{pre:function(h,j,k){function m(a,c){if(!C||C.length<1)return h[q]=[],z=0,v(0),void(h.sizesCumulative=[0]);if(z=C.length,H){h.sizes=C.map(function(a){var c=h.$new(!1);b.extend(c,a),c[n]=a;var d=k.vsSize||k.vsSizeProperty?c.$eval(k.vsSize||k.vsSizeProperty):h.elementSize;return c.$destroy(),d});var d=0;h.sizesCumulative=h.sizes.map(function(a){var b=d;return d+=a,b}),h.sizesCumulative.push(d)}else s();u(c)}function s(){G&&h.$$postDigest(function(){if(j[0].offsetHeight||j[0].offsetWidth)for(var a=j.children(),b=0;b<a.length;){if(null!=a[b].attributes["ng-repeat"]||null!=a[b].attributes["data-ng-repeat"]){a[b][M]&&(h.elementSize=a[b][M],u(),G=!1,h.$root&&!h.$root.$$phase&&h.$apply());break}b++}else var c=h.$watch(function(){(j[0].offsetHeight||j[0].offsetWidth)&&(c(),s())})})}function t(){"undefined"!=typeof k.vsAutoresize&&(G=!0,s(),h.$root&&!h.$root.$$phase&&h.$apply()),y()&&h.$apply()}function u(a){O=void 0,P=void 0,Q=z,R=0,y(a),v(H?h.sizesCumulative[z]:h.elementSize*z),h.$emit("vsRepeatReinitialized",h.startIndex,h.endIndex)}function v(a){h.totalSize=h.offsetBefore+a+h.offsetAfter}function w(){var a=d(I[0],L);a!==S&&(u(),h.$root&&!h.$root.$$phase&&h.$apply()),S=a}function x(a){var b=!1;return void 0!==a&&"number"==typeof a&&(b=Math.max(a,0),I[0][N]!==b?(I[0][N]=b,J=!0):b=!1,h.$emit("vsRepeatScrolled",b)),b}function y(a){var b,c,i,k,l=e(I[0],N),m=d(I[0],L),n=j[0]===I[0]?0:f(j[0],I[0],D),o=!0,p=h.startIndex,r=h.endIndex;if(a&&void 0!==a.elementSize&&(h.elementSize=a.elementSize),a&&void 0!==a.scrollIndex){if("undefined"!=typeof h.scrollSettings&&(h.scrollSettings.scrollIndex=a.scrollIndex),H?(k=h.sizes[a.scrollIndex],i=h.sizesCumulative[a.scrollIndex]):(k=h.elementSize,i=a.scrollIndex*h.elementSize),void 0!==a.scrollIndexPosition)switch("undefined"!=typeof h.scrollSettings&&(h.scrollSettings.scrollIndexPosition=a.scrollIndexPosition),b=0,typeof a.scrollIndexPosition){case"number":b=a.scrollIndexPosition+h.offsetBefore;break;case"string":switch(a.scrollIndexPosition){case"top":b=h.offsetBefore;break;case"middle":b=(m-k)/2;break;case"bottom":b=m-k-h.offsetAfter;break;case"inview":case"inview#top":case"inview#middle":case"inview#bottom":case"inview#auto":I[0][N]<=i&&I[0][N]+m-k>=i?(o=!1,b=i-I[0][N]):(("inview#top"===a.scrollIndexPosition||"inview"===a.scrollIndexPosition)&&(b=h.offsetBefore),"inview#bottom"===a.scrollIndexPosition&&(b=m-k+h.offsetAfter),"inview#middle"===a.scrollIndexPosition&&(b=(m-k)/2),"inview#auto"===a.scrollIndexPosition&&(b=I[0][N]<=i?m-k+h.offsetAfter:h.offsetBefore));break;default:console.warn("Incorrect scrollIndexPosition string value")}break;default:console.warn("Incorrect scrollIndexPosition type")}else o=!1,b=H?h.sizesCumulative[a.scrollIndex]-I[0][N]:a.scrollIndex*h.elementSize-I[0][N];if(p=a.scrollIndex,H){for(;h.sizesCumulative[p]>h.sizesCumulative[a.scrollIndex]-b;)p--;for(c=Math.max(p,0),p=Math.max(Math.floor(p-h.excess/2),0),r=p;h.sizesCumulative[r]<h.sizesCumulative[c]-h.offsetBefore+m;)r++;r=Math.min(Math.ceil(r+h.excess/2),z)}else{for(;p*h.elementSize>a.scrollIndex*h.elementSize-b;)p--;c=Math.max(p,0),p=Math.max(Math.floor(p-h.excess/2),0),r=Math.min(p+Math.ceil(m/h.elementSize)+h.excess/2,z)}}else if(H){for(p=0;h.sizesCumulative[p]<l-h.offsetBefore-n;)p++;for(p>0&&p--,p=Math.max(Math.floor(p-h.excess/2),0),r=p;h.sizesCumulative[r]<l-h.offsetBefore-n+m;)r++;r=Math.min(Math.ceil(r+h.excess/2),z)}else p=Math.max(Math.floor((l-h.offsetBefore-n)/h.elementSize)-h.excess/2,0),r=Math.min(p+Math.ceil(m/h.elementSize)+h.excess,z);Q=Math.min(p,Q),R=Math.max(r,R),h.startIndex=K.latch?Q:p,h.endIndex=K.latch?R:r,void 0!==a&&void 0!==a.scrollIndex&&void 0!==b&&o&&x(i-b);var s=!1;return null==O?s=!0:null==P&&(s=!0),s||(K.hunked?Math.abs(h.startIndex-O)>=h.excess/2||0===h.startIndex&&0!==O?s=!0:(Math.abs(h.endIndex-P)>=h.excess/2||h.endIndex===z&&P!==z)&&(s=!0):s=h.startIndex!==O||h.endIndex!==P),s&&(h[q]=C.slice(h.startIndex,h.endIndex),h.$emit("vsRepeatInnerCollectionUpdated",h.startIndex,h.endIndex,O,P),O=h.startIndex,P=h.endIndex,h.$$postDigest(function(){var a=H?"(sizesCumulative[$index + startIndex] + offsetBefore)":"(($index + startIndex) * elementSize + offsetBefore)",b=g(a),c=b(h,{$index:0}),d=b(h,{$index:h[q].length}),e=h.totalSize,f=D?"width":"height";E.css(f,c+"px"),F.css(f,e-d+"px")})),s}var z,A=b.element(l),B=A[0].tagName.toLowerCase(),C=[],D="undefined"!=typeof k.vsHorizontal,E=b.element("<"+B+' class="vs-repeat-before-content"></'+B+">"),F=b.element("<"+B+' class="vs-repeat-after-content"></'+B+">"),G=!k.vsRepeat,H=!!k.vsSize||!!k.vsSizeProperty,I=k.vsScrollParent?"window"===k.vsScrollParent?b.element(a):i.call(j,k.vsScrollParent):j,J=!1,K="vsOptions"in k?h.$eval(k.vsOptions):{},L=D?"clientWidth":"clientHeight",M=D?"offsetWidth":"offsetHeight",N=D?"scrollLeft":"scrollTop";if(h.totalSize=0,!("vsSize"in k)&&"vsSizeProperty"in k&&console.warn("vs-size-property attribute is deprecated. Please use vs-size attribute which also accepts angular expressions."),0===I.length)throw"Specified scroll parent selector did not match any element";h.$scrollParent=I,H&&(h.sizesCumulative=[]),h.elementSize=+k.vsRepeat||d(I[0],L)||50,h.offsetBefore=0,h.offsetAfter=0,h.excess=2,h.scrollSettings={scrollIndex:0,scrollIndexPosition:"top"},D?(E.css("height","100%"),F.css("height","100%")):(E.css("width","100%"),F.css("width","100%")),h.$watch(k.vsScrollSettings,function(a){"undefined"!=typeof a&&(h.scrollSettings=a,u(h.scrollSettings))},!0),Object.keys(r).forEach(function(a){k[a]&&k.$observe(a,function(b){h[r[a]]=+b,u()})}),h.$watchCollection(o,function(a){C=a||[],m()}),A.attr("ng-repeat",n+" in "+q+(p?" "+p:"")).addClass("vs-repeat-repeated-element"),j.append(E),j.append(A),c(A)(h),j.append(F),h.startIndex=0,h.endIndex=0,I.on("scroll",function(){J?J=!1:y()&&h.$apply()}),b.element(a).on("resize",t),h.$on("$destroy",function(){b.element(a).off("resize",t)}),h.$on("vsRepeatTrigger",m),h.$on("vsRepeatResize",function(){G=!0,s()});var O,P,Q,R;h.$on("vsRenderAll",function(){K.latch&&setTimeout(function(){var a=z;R=Math.max(a,R),h.endIndex=K.latch?R:a,h[q]=C.slice(h.startIndex,h.endIndex),P=h.endIndex,h.$$postDigest(function(){var a=D?"width":"height";E.css(a,0),F.css(a,0)}),h.$apply(function(){h.$emit("vsRenderAllDone")})})});var S;h.$watch(function(){"function"==typeof a.requestAnimationFrame?a.requestAnimationFrame(w):w()})}}}}}]);"undefined"!=typeof module&&module.exports&&(module.exports=j.name)}(window,window.angular);